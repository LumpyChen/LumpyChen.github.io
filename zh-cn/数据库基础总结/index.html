<!DOCTYPE html><html lang="en,zh-cn,default"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 数据库基础总结 · LANTAU</title><meta name="description" content="数据库基础总结 - Lumpy"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://lumpychen.github.io/atom.xml" title="LANTAU"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link active">ARCHIVE</a></li><li class="nav-list-item"><a href="https://www.zhihu.com/people/irvingchen" target="_blank" class="nav-list-link">ZHIHU</a></li><li class="nav-list-item"><a href="https://lumpychen.github.io/cv_web/" target="_blank" class="nav-list-link">RESUME</a></li><li class="nav-list-item"><a href="https://github.com/lumpychen" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="license"><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a><div class="license-text">Every post in this blog is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>. You can check the source code at <a href="https://github.com/LumpyChen/LumpyChen.github.io">my github</a>.</div></section><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">数据库基础总结</h1><div class="post-info">2017年9月10日</div><div class="post-tags"><a href="/tags/basic/" class="post-tag"> basic</a><a href="/tags/mysql/" class="post-tag"> mysql</a></div><div class="post-content"><link rel="stylesheet" href="/owl.css"><p>把之前学过的<code>SQL</code>的知识复习一遍，记一下难点。</p>
<a id="more"></a>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><ul>
<li>数值类型 <code>INT</code>、<code>FLOAT</code></li>
<li>字符串类型 <code>CHAR</code>、<code>TEXT</code></li>
<li>日期和时间类型 <code>DATE</code>、<code>TIMESTAMP</code></li>
<li>复合类型 <code>ENUM</code>、<code>SET</code></li>
</ul>
<p>其中一个<code>ENUM</code>类型只允许从一个集合中取得一个值；而<code>SET</code>类型允许从一个集合（元素不能重复的）中取得任意多个值</p>
<h2 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h2><ul>
<li>任意两行都不具有相同的主键值</li>
<li>每一行都必须具有一个主键值（主键列不允许<code>NULL</code>值），虽然不一定需要</li>
<li>主键列中的值不允许修改或更新</li>
<li>主键值不能重用(如果某行从表中删除，它的主键不能赋给以后的新行)。</li>
</ul>
<h2 id="Select"><a href="#Select" class="headerlink" title="Select"></a>Select</h2><h4 id="命令排序"><a href="#命令排序" class="headerlink" title="命令排序"></a>命令排序</h4><ol>
<li>SELECT 要返回的列或表达式</li>
<li>FROM 从中检索数据的表</li>
<li>WHERE 行级过滤</li>
<li>GROUP BY 分组说明</li>
<li>HAVING 组级过滤</li>
<li>ORDER BY 输出排序顺序</li>
</ol>
<h4 id="不同的值"><a href="#不同的值" class="headerlink" title="不同的值"></a>不同的值</h4><p><code>DISTINCT</code></p>
<p>返回所有学生的年龄</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> age</span><br><span class="line"><span class="keyword">FROM</span> student</span><br></pre></td></tr></table></figure>
<h4 id="LIMIT"><a href="#LIMIT" class="headerlink" title="LIMIT"></a>LIMIT</h4><p>检索记录行 6、7、8</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> age</span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">5</span> <span class="keyword">offset</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>检索前 5 个记录行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> age</span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">5</span></span><br></pre></td></tr></table></figure>
<h4 id="顺序"><a href="#顺序" class="headerlink" title="顺序"></a>顺序</h4><p><code>ORDER BY</code></p>
<p>按照排列对象二进制的编码从小到大排序</p>
<blockquote>
<p>Comparing the ASCII one by one until difference found, or, one reach the end of the string, it’s the same logic in other program languages.</p>
</blockquote>
<p><code>DESC</code>倒序</p>
<p>从贵到便宜排列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> age</span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>
<h4 id="与或"><a href="#与或" class="headerlink" title="与或"></a>与或</h4><p><code>SQL</code>先处理<code>AND</code>在处理<code>OR</code></p>
<h4 id="HAVING-和-WHERE"><a href="#HAVING-和-WHERE" class="headerlink" title="HAVING 和 WHERE"></a>HAVING 和 WHERE</h4><p><code>WHERE</code>过滤行、<code>HAVING</code>过滤分组<br><code>WHERE</code>在数据分组前进行过滤，<code>HAVING</code>在数据分组后进行过滤<br><code>WHERE</code>排除的行不包括在分组中，这可能会改变<code>HAVING</code>子句中基于这些值过滤掉的分组</p>
<h4 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h4><p>可以把一条<code>SELECT</code>语句返回的结果用于另一条<code>SELECT</code>语句的<code>WHERE</code>子句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_id</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">WHERE</span> order_num <span class="keyword">IN</span> (<span class="keyword">SELECT</span> order_num</span><br><span class="line">                    <span class="keyword">FROM</span> OrderItems</span><br><span class="line">                    <span class="keyword">WHERE</span> prod_id = <span class="string">'RGAN01'</span>)</span><br></pre></td></tr></table></figure>
<p>在SELECT语句中，子查询总是从内向外处理</p>
<p>作为子查询的SELECT语句只能查询单个列，企图检索多个列将返回错误</p>
<h4 id="作为计算字段使用子查询"><a href="#作为计算字段使用子查询" class="headerlink" title="作为计算字段使用子查询"></a>作为计算字段使用子查询</h4><p>查询一个顾客的订单数量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> orders</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">WHERE</span> cust_id = <span class="string">'1000000001'</span></span><br></pre></td></tr></table></figure>
<p>查询所有顾客的订单数量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_name,</span><br><span class="line">cust_state,</span><br><span class="line">(<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*)</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">WHERE</span> Orders.cust_id = Customers.cust_id) <span class="keyword">AS</span> orders</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_name;</span><br></pre></td></tr></table></figure>
<h4 id="联结"><a href="#联结" class="headerlink" title="联结"></a>联结</h4><p>如果数据存储在多个表中，怎样用一条<code>SELECT</code>语句就检索出数据呢？答案是使用联结：</p>
<ul>
<li>内联结</li>
<li>外联结</li>
<li>交叉联结</li>
</ul>
<p>假设有以下两个表，其中<code>a.id</code>同<code>b.parent_id</code>存在关系：</p>
<p>A表</p>
<table>
<thead>
<tr>
<th style="text-align:center">id</th>
<th style="text-align:center">name</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">张三</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">李四</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">王五</td>
</tr>
</tbody>
</table>
<p>B表</p>
<table>
<thead>
<tr>
<th style="text-align:center">id</th>
<th style="text-align:center">job</th>
<th style="text-align:center">paremt</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">23</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">34</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">34</td>
<td style="text-align:center">4</td>
</tr>
</tbody>
</table>
<ul>
<li>内联结根据每个表<strong>共有的列</strong>的值匹配两个表中的行</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.*,b.* <span class="keyword">FROM</span> a <span class="keyword">INNER</span> <span class="keyword">JOIN</span> b <span class="keyword">on</span> a.id=b.parent_id</span><br></pre></td></tr></table></figure>
<p>返回结果：</p>
<blockquote>
<p>1   张三                 1     23     1<br>2   李四                 2     34     2   </p>
</blockquote>
<ul>
<li>左向外连接的结果集包括指定的左表的所有行，如果左表的某行在右表中没有匹配行，则在相关联的结果集行中右表的所有选择列表列均为空</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.*,b.* <span class="keyword">FROM</span> a <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> b <span class="keyword">on</span> a.id=b.parent_id</span><br></pre></td></tr></table></figure>
<p>返回结果：</p>
<blockquote>
<p>1   张三                  1     23     1<br>2   李四                  2     34     2<br>3   王五                  null</p>
</blockquote>
<ul>
<li>右向外连接的结果集包括指定的右表的所有行，如果左表的某行在右表中没有匹配行，则将为左表返回空值</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.*,b.* <span class="keyword">FROM</span> a <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> b <span class="keyword">on</span> a.id=b.parent_id</span><br></pre></td></tr></table></figure>
<p>返回结果：</p>
<p>1   张三                  1     23     1<br>2   李四                  2     34     2<br>  null                   3     34     4  </p>
<ul>
<li>完整外部连接返回左表和右表中的所有行</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.*,b.* <span class="keyword">FROM</span> a <span class="keyword">FULL</span> <span class="keyword">JOIN</span> b <span class="keyword">on</span> a.id=b.parent_id</span><br></pre></td></tr></table></figure>
<p>返回结果：</p>
<blockquote>
<p>1   张三                 1     23     1<br>2   李四                 2     34     2<br>  null               　　3     34     4<br>3   王五                 null</p>
</blockquote>
<ul>
<li>交叉联结，两个表的数据进行组合</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.*,b.* <span class="keyword">FROM</span> a <span class="keyword">CROSS</span> <span class="keyword">JOIN</span> b</span><br></pre></td></tr></table></figure>
<p>返回<code>3*3=9</code>条数据</p>
<ul>
<li>自联结，一个表出现多次</li>
</ul>
<h4 id="UNION"><a href="#UNION" class="headerlink" title="UNION"></a>UNION</h4><p>可用<code>UNION</code>操作符来组合数条<code>SQL</code>查询。利用<code>UNION</code>，可给出多条<code>SELECT</code>语句，将它们的结果组合成一个结果集（不能重复）</p>
<p>如果需要重复，使用<code>UNION ALL</code></p>
<h2 id="INSERT"><a href="#INSERT" class="headerlink" title="INSERT"></a>INSERT</h2><h4 id="正常添加行"><a href="#正常添加行" class="headerlink" title="正常添加行"></a>正常添加行</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Customers</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">'10001'</span>, <span class="string">'TONY'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="移植多行"><a href="#移植多行" class="headerlink" title="移植多行"></a>移植多行</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Customers(cust_id,</span><br><span class="line">                      cust_email,</span><br><span class="line">                      cust_name,</span><br><span class="line">                      cust_address,</span><br><span class="line">                      cust_city,</span><br><span class="line">                      cust_state,</span><br><span class="line">                      cust_zip,</span><br><span class="line">                      cust_country)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">cust_id,</span><br><span class="line">cust_contact,</span><br><span class="line">cust_email,</span><br><span class="line">cust_name,</span><br><span class="line">cust_address,</span><br><span class="line">cust_city,</span><br><span class="line">cust_state,</span><br><span class="line">cust_zip,</span><br><span class="line">cust_country</span><br><span class="line">cust_contact,</span><br><span class="line">cust_email,</span><br><span class="line">cust_name,</span><br><span class="line">cust_address,</span><br><span class="line">cust_city,</span><br><span class="line">cust_state,</span><br><span class="line">cust_zip,</span><br><span class="line">cust_country)</span><br><span class="line"><span class="keyword">FROM</span> CustNew;</span><br></pre></td></tr></table></figure>
<h4 id="复制表"><a href="#复制表" class="headerlink" title="复制表"></a>复制表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">INTO</span> CustCopy</span><br><span class="line"><span class="keyword">FROM</span> Customers;</span><br></pre></td></tr></table></figure>
<h2 id="UPDATE-amp-DELETE"><a href="#UPDATE-amp-DELETE" class="headerlink" title="UPDATE &amp; DELETE"></a>UPDATE &amp; DELETE</h2><h4 id="正常更新行"><a href="#正常更新行" class="headerlink" title="正常更新行"></a>正常更新行</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> Customers</span><br><span class="line"><span class="keyword">SET</span> cust_contact = <span class="string">'Sam Roberts'</span>,</span><br><span class="line">  cust_email = <span class="string">'sam@toyland.com'</span></span><br><span class="line"><span class="keyword">WHERE</span> cust_id = <span class="string">'1000000006'</span>;</span><br></pre></td></tr></table></figure>
<h4 id="正常删除表"><a href="#正常删除表" class="headerlink" title="正常删除表"></a>正常删除表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_id = <span class="string">'1000000006'</span></span><br></pre></td></tr></table></figure>
<p>使用外键的好处是防止删除某个关系需要用到的行：<br>例如，要从<code>Products</code>表中删除一个产品，而这个产品用在<code>OrderItems</code>的已有订单中，那么DELETE语句将抛出错误并中止</p>
<h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><h2 id="管理事务"><a href="#管理事务" class="headerlink" title="管理事务"></a>管理事务</h2><ol>
<li>检查数据库中是否存在相应的顾客，如果不存在，添加他;</li>
<li>提交顾客信息;</li>
<li>检索顾客的<code>ID</code>;</li>
<li>在<code>Orders</code>表中添加一行;</li>
<li>如果向<code>Orders</code>表添加行时出现故障，回退;</li>
<li>检索<code>Orders</code>表中赋予的新订单<code>ID</code>;</li>
<li>对于订购的每项物品，添加新行到<code>OrderItems</code>表;</li>
<li>如果向<code>OrderItems</code>添加行时出现故障，回退所有添加的<code>OrderItems</code>行和<code>Orders</code>行</li>
</ol>
<h2 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h2><ul>
<li>主键<code>PRIMARY KEY</code></li>
<li>外键<code>REFERENCES XX(XX)</code></li>
<li>唯一约束<code>UNIQUE</code></li>
<li>检查约束<code>CHECK(xx &gt; xx)</code></li>
</ul>
<h4 id="唯一约束和主键的区别"><a href="#唯一约束和主键的区别" class="headerlink" title="唯一约束和主键的区别"></a>唯一约束和主键的区别</h4><ul>
<li>表可包含多个唯一约束，但每个表只允许一个主键。</li>
<li>唯一约束列可包含<code>NULL</code>值。</li>
<li>唯一约束列可修改或更新。</li>
<li>唯一约束列的值可重复使用。</li>
<li>与主键不一样，唯一约束不能用来定义外键。</li>
</ul>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><ul>
<li>索引改善检索操作的性能，但降低了数据插入、修改和删除的性能。在执行这些操作时，DBMS必须动态地更新索引。</li>
<li>索引数据可能要占用大量的存储空间。 并非所有数据都适合做索引。取值不多的数据(如州)不如具有更多可能值的数据(如姓或名)，能通过索引得到那么多的好处。</li>
<li>索引用于数据过滤和数据排序。如果你经常以某种特定的顺序排序数据，则该数据可能适合做索引。</li>
<li>可以在索引中定义多个列(例如，州加上城市)。这样的索引仅在以州加城市的顺序排序时有用。如果想按城市排序，则这种索引没有用处。</li>
</ul>
<h2 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h2><ul>
<li>对数据库管理功能(创建表、更改或删除已存在的表等)的访问;</li>
<li>对特定数据库或表的访问;</li>
<li>访问的类型(只读、对特定列的访问等);</li>
<li>仅通过视图或存储过程对表进行访问;</li>
<li>创建多层次的安全措施，从而允许多种基于登录的访问和控制;</li>
<li>限制管理用户账号的能力。</li>
</ul>
</div></article></div></section><footer><div class="paginator"><a href="/zh-cn/JS版本的数据结构与算法/" class="prev">上一篇</a><a href="/zh-cn/认证授权/" class="next">下一篇</a></div><div class="copyright"><p>© 2016 - 2017 <a href="http://lumpychen.github.io">Lumpy</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>